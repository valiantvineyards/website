---
import BaseLayout from "./BaseLayout.astro";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import defaultImage from "../assets/images/wine-bottles-with-medals-landscape.webp";

interface Props {
  title: string;
  description: string;
  date: Date;
  featuredImage?: ImageMetadata;
  featuredImageAlt?: string;
}

const { title, description, date, featuredImage, featuredImageAlt } = Astro.props;
const image = featuredImage ?? defaultImage;
const imageAlt = featuredImageAlt ?? title;
const formattedDate = date.toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<BaseLayout title={title} description={description} image={image.src} type="article">
  <article class="container mx-auto px-4 lg:px-8 py-12 lg:py-16">
    <div class="mx-auto max-w-3xl">
      <!-- Featured Image -->
      <div class="mb-8 aspect-3/2 overflow-hidden">
        <Image
          src={image}
          alt={imageAlt}
          widths={[640, 800, 1024]}
          sizes="(max-width: 768px) 100vw, 768px"
          quality={70}
          class="h-full w-full object-cover"
        />
      </div>

      <!-- Title -->
      <header class="mb-10 text-center">
        <h1 class="font-serif text-3xl font-semibold tracking-tight text-foreground sm:text-4xl lg:text-5xl">
          {title}
        </h1>
        <p class="mt-4 text-sm text-muted-foreground">
          Posted {formattedDate}
        </p>
      </header>

      <div class="prose prose-lg max-w-none">
        <slot />
      </div>

      <footer class="mt-12 pt-8 border-t border-neutral-200">
        <a
          href="/stories/"
          class="inline-flex items-center text-gold hover:text-gold/80 font-medium transition-colors"
        >
          <svg
            class="w-4 h-4 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            />
          </svg>
          Back to Stories
        </a>
      </footer>
    </div>
  </article>
</BaseLayout>

<style is:global>
  .prose {
    color: var(--color-foreground, #1a1a1a);
  }

  .prose h2 {
    font-family: var(--font-serif, Georgia, serif);
    font-size: 1.75rem;
    font-weight: 600;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    color: var(--color-foreground, #1a1a1a);
  }

  .prose h3 {
    font-family: var(--font-serif, Georgia, serif);
    font-size: 1.375rem;
    font-weight: 600;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    color: var(--color-foreground, #1a1a1a);
  }

  .prose p {
    margin-bottom: 1.25rem;
    line-height: 1.75;
  }

  .prose a {
    color: var(--color-gold, #b8860b);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .prose a:hover {
    color: var(--color-gold, #b8860b);
    opacity: 0.8;
  }

  .prose strong {
    font-weight: 700;
    color: var(--color-foreground, #1a1a1a);
  }

  .prose ul,
  .prose ol {
    margin-bottom: 1.25rem;
    padding-left: 1.5rem;
  }

  .prose li {
    margin-bottom: 0.5rem;
  }

  .prose ul li {
    list-style-type: disc;
  }

  .prose ol li {
    list-style-type: decimal;
  }

  .prose img {
    margin: 2rem 0;
  }

  .prose blockquote {
    border-left: 4px solid var(--color-gold, #b8860b);
    padding-left: 1.5rem;
    margin: 1.5rem 0;
    font-style: italic;
    color: var(--color-muted-foreground, #6b7280);
  }

  .prose iframe {
    max-width: 100%;
    margin: 2rem 0;
  }

  .prose iframe[src*="youtube"],
  .prose iframe[src*="vimeo"] {
    height: auto;
    aspect-ratio: 16 / 9;
  }
</style>
