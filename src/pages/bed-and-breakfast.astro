---
import BaseLayout from "../layouts/BaseLayout.astro";
import Button from "../components/Button.astro";
import RoomImageWithGallery from "../components/RoomImageWithGallery.svelte";
import { Image, getImage } from "astro:assets";
import HeroImage from "../components/HeroImage.astro";
import heroImage from "../assets/images/wine-glass-next-to-bed-with-lamp.webp";

// Import all room images
// Honeymoon Suite
import honeymoon1 from "../assets/images/rooms/honeymoon-suite/honeymoon-suite-1.jpg";
import honeymoon3 from "../assets/images/rooms/honeymoon-suite/honeymoon-suite-3.jpg";
import honeymoon5 from "../assets/images/rooms/honeymoon-suite/honeymoon-suite-5.jpg";
import honeymoon6 from "../assets/images/rooms/honeymoon-suite/honeymoon-suite-6.jpg";
import honeymoon7 from "../assets/images/rooms/honeymoon-suite/honeymoon-suite-7.jpg";
import honeymoon8 from "../assets/images/rooms/honeymoon-suite/honeymoon-suite-8.jpg";
import honeymoon9 from "../assets/images/rooms/honeymoon-suite/honeymoon-suite-9.jpg";
import honeymoon11 from "../assets/images/rooms/honeymoon-suite/honeymoon-suite-11.jpg";

// Frontier Room
import frontier1 from "../assets/images/rooms/frontier-room/frontier-room-1.jpg";
import frontier2 from "../assets/images/rooms/frontier-room/frontier-room-2.jpg";
import frontier3 from "../assets/images/rooms/frontier-room/frontier-room-3.jpg";

// Queen Anne Room
import queenAnne1 from "../assets/images/rooms/queen-anne-room/queen-anne-room-1.jpg";
import queenAnne2 from "../assets/images/rooms/queen-anne-room/queen-anne-room-2.jpg";
import queenAnne3 from "../assets/images/rooms/queen-anne-room/queen-anne-room-3.jpg";

// USD Room
import usd0 from "../assets/images/rooms/usd-room/usd-room-0.jpg";
import usd1 from "../assets/images/rooms/usd-room/usd-room-1.jpg";
import usd2 from "../assets/images/rooms/usd-room/usd-room-2.jpg";
import usd3 from "../assets/images/rooms/usd-room/usd-room-3.jpg";
import usd4 from "../assets/images/rooms/usd-room/usd-room-4.jpg";
import usd5 from "../assets/images/rooms/usd-room/usd-room-5.jpg";
import usd6 from "../assets/images/rooms/usd-room/usd-room-6.jpg";
import usd8 from "../assets/images/rooms/usd-room/usd-room-8.jpg";
import usd9 from "../assets/images/rooms/usd-room/usd-room-9.jpg";
import usd10 from "../assets/images/rooms/usd-room/usd-room-10.jpg";

// John Crane Room
import johnCrane1 from "../assets/images/rooms/john-crane-room/john-crane-room-1.jpg";
import johnCrane2 from "../assets/images/rooms/john-crane-room/john-crane-room-2.jpg";
import johnCrane3 from "../assets/images/rooms/john-crane-room/john-crane-room-3.jpg";
import johnCrane4 from "../assets/images/rooms/john-crane-room/john-crane-room-4.jpg";

// Native American Room
import nativeAmerican1 from "../assets/images/rooms/native-american-room/native-american-room-1.jpg";
import nativeAmerican2 from "../assets/images/rooms/native-american-room/native-american-room-2.jpg";
import nativeAmerican3 from "../assets/images/rooms/native-american-room/native-american-room-3.jpg";
import nativeAmerican4 from "../assets/images/rooms/native-american-room/native-american-room-4.jpg";

// Helper to optimize images at different sizes
async function optimizeImagesMultiSize(images: { src: ImageMetadata; alt: string }[]) {
  const results = await Promise.all(
    images.map(async (img) => {
      const [full, thumb] = await Promise.all([
        getImage({ src: img.src, width: 1200, format: 'webp', quality: 85 }),
        getImage({ src: img.src, width: 600, format: 'webp', quality: 80 }),
      ]);
      // Calculate height based on original aspect ratio
      const aspectRatio = img.src.height / img.src.width;
      const height = Math.round(1200 * aspectRatio);
      return {
        full: { src: full.src, alt: img.alt, width: 1200, height },
        thumb: { src: thumb.src, alt: img.alt },
      };
    })
  );
  return {
    images: results.map(r => r.full),
    thumbnails: results.map(r => r.thumb),
  };
}

// Room data with optimized images
const honeymoonImages = await optimizeImagesMultiSize([
  { src: honeymoon1, alt: "Honeymoon Suite" },
  { src: honeymoon3, alt: "Honeymoon Suite" },
  { src: honeymoon5, alt: "Honeymoon Suite" },
  { src: honeymoon6, alt: "Honeymoon Suite" },
  { src: honeymoon7, alt: "Honeymoon Suite" },
  { src: honeymoon8, alt: "Honeymoon Suite" },
  { src: honeymoon9, alt: "Honeymoon Suite" },
  { src: honeymoon11, alt: "Honeymoon Suite" },
]);

const frontierImages = await optimizeImagesMultiSize([
  { src: frontier1, alt: "Frontier Room" },
  { src: frontier2, alt: "Frontier Room" },
  { src: frontier3, alt: "Frontier Room" },
]);

const queenAnneImages = await optimizeImagesMultiSize([
  { src: queenAnne1, alt: "Queen Anne Room" },
  { src: queenAnne2, alt: "Queen Anne Room" },
  { src: queenAnne3, alt: "Queen Anne Room" },
]);

const usdImages = await optimizeImagesMultiSize([
  { src: usd0, alt: "USD Room" },
  { src: usd1, alt: "USD Room" },
  { src: usd2, alt: "USD Room" },
  { src: usd3, alt: "USD Room" },
  { src: usd4, alt: "USD Room" },
  { src: usd5, alt: "USD Room" },
  { src: usd6, alt: "USD Room" },
  { src: usd8, alt: "USD Room" },
  { src: usd9, alt: "USD Room" },
  { src: usd10, alt: "USD Room" },
]);

const johnCraneImages = await optimizeImagesMultiSize([
  { src: johnCrane1, alt: "John Crane Room" },
  { src: johnCrane2, alt: "John Crane Room" },
  { src: johnCrane3, alt: "John Crane Room" },
  { src: johnCrane4, alt: "John Crane Room" },
]);

const nativeAmericanImages = await optimizeImagesMultiSize([
  { src: nativeAmerican1, alt: "Native American Room" },
  { src: nativeAmerican2, alt: "Native American Room" },
  { src: nativeAmerican3, alt: "Native American Room" },
  { src: nativeAmerican4, alt: "Native American Room" },
]);

const rooms = [
  {
    name: "Honeymoon Suite",
    price: "$150+",
    specialPrice: "$195",
    description: "The Honeymoon Suite offers a luxurious King-size bed, a private bath with shower, and an indulgent in-room Jacuzzi tub—ideal for romantic getaways.",
    features: ["King Bed", "In-Room Jacuzzi", "Private Bath"],
    ...honeymoonImages,
  },
  {
    name: "Frontier Room",
    price: "$140+",
    specialPrice: "$175",
    description: "The Frontier Room features two comfortable Queen beds and a private bath with a relaxing Jacuzzi tub and shower—blending rustic charm with modern amenities.",
    features: ["2 Queen Beds", "Jacuzzi Tub", "Private Bath"],
    ...frontierImages,
  },
  {
    name: "Queen Anne Room",
    price: "$135+",
    specialPrice: "$175",
    description: "The Queen Anne Room features two comfortable Queen beds and a private bath with a relaxing Jacuzzi tub and shower—perfect for unwinding.",
    features: ["2 Queen Beds", "Jacuzzi Tub", "Private Bath"],
    ...queenAnneImages,
  },
  {
    name: "USD Room",
    price: "$135+",
    specialPrice: "$175",
    description: "The University of South Dakota Room offers two inviting Queen beds and a private bath with a soothing Jacuzzi tub and shower.",
    features: ["2 Queen Beds", "USD Theme", "Private Bath"],
    ...usdImages,
  },
  {
    name: "John Crane Room",
    price: "$130+",
    specialPrice: "$175",
    description: "The newly renovated John Crane Room offers a luxurious King-size bed and all the comforts of a classic bed-and-breakfast retreat, featuring European reading furnishings.",
    features: ["King Bed", "Reading Nook", "Private Bath"],
    ...johnCraneImages,
  },
  {
    name: "Native American Room",
    price: "$125+",
    specialPrice: "$160",
    description: "Designed for comfort and accessibility, the Native American Room features two Queen-size beds and a spacious private bath. This handicap-accessible suite offers beautiful Native American decor.",
    features: ["2 Queen Beds", "Accessible", "Private Bath"],
    ...nativeAmericanImages,
  },
];

const amenities = [
  { id: "tasting", title: "Tasting Included", description: "Complimentary wine & spirits tasting for all guests" },
  { id: "breakfast", title: "Homemade Breakfast", description: "Served daily from 8:00 - 10:00 AM" },
  { id: "location", title: "Prime Location", description: "Minutes from USD and downtown Vermillion" },
  { id: "bath", title: "Private Baths", description: "Each room features its own private bathroom" },
];
---

<BaseLayout title="Bed & Breakfast" description="Stay overnight at Valiant Vineyards Bed & Breakfast. Six uniquely themed rooms with complimentary wine tasting and homemade breakfast.">
  <!-- Hero Section -->
  <section class="relative">
    <div class="relative min-h-[60vh] xl:min-h-[75vh] flex items-center justify-center py-24 bg-neutral-900">
      <HeroImage
        src={heroImage}
        alt="Cozy bed with wine glass at Valiant Vineyards Bed and Breakfast"
        widths={[640, 1024, 1536, 2048]}
        sizes="100vw"
        quality={90}
      />
      <div class="container relative mx-auto px-4 lg:px-8 text-center">
        <div class="inline-block bg-black/50 px-8 py-6">
          <h1 class="font-serif text-4xl font-semibold tracking-tight text-white sm:text-5xl lg:text-6xl">
            Stay With Us
          </h1>
          <p class="mt-4 font-serif text-xl text-white font-medium max-w-2xl mx-auto lg:text-2xl">
            Relax, unwind, and savor the charm of South Dakota's oldest winery.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Introduction -->
  <section class="py-16 lg:py-24">
    <div class="container mx-auto px-4 lg:px-8">
      <div class="mx-auto max-w-3xl text-center">
        <h2 class="font-serif text-3xl font-semibold tracking-tight sm:text-4xl mb-6">
          A Signature Winery & Distillery Stay
        </h2>
        <p class="text-lg leading-relaxed text-muted-foreground mb-4">
          Relax in one of our six uniquely themed rooms and enjoy a memorable retreat surrounded by handcrafted wines, spirits, and warm South Dakota hospitality.
        </p>
        <p class="text-lg leading-relaxed text-muted-foreground">
          Your stay includes complimentary wine and spirit tasting and a delicious homemade breakfast served each morning.
        </p>
      </div>
    </div>
  </section>

  <!-- Amenities -->
  <section class="bg-neutral-50 py-16 lg:py-20">
    <div class="container mx-auto px-4 lg:px-8">
      <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-4 max-w-5xl mx-auto">
        {amenities.map((amenity) => (
          <div class="text-center">
            <div class="mb-3 flex justify-center">
              {amenity.id === "tasting" && (
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-auto text-gold" fill="currentColor" viewBox="0 0 320 560">
                  <path d="M48.6 11.8C50.5 4.8 56.8 0 64 0L256 0c7.2 0 13.5 4.8 15.4 11.8l43 157.8c3.7 13.5 5.5 27.4 5.5 41.3 0 82.4-63.4 149.9-144 156.6l0 144.5 80 0c8.8 0 16 7.2 16 16s-7.2 16-16 16L64 544c-8.8 0-16-7.2-16-16s7.2-16 16-16l80 0 0-144.5c-80.6-6.7-144-74.2-144-156.6 0-14 1.9-27.9 5.5-41.3l43-157.8zM41.3 160l-4.9 18C33.5 188.7 32 199.8 32 210.9 32 280 88 336 157.1 336l5.8 0c69.1 0 125.1-56 125.1-125.1 0-11.1-1.5-22.2-4.4-32.9l-4.9-18-237.4 0zM50 128L270 128 243.8 32 76.2 32 50 128z"/>
                </svg>
              )}
              {amenity.id === "breakfast" && (
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gold" fill="currentColor" viewBox="0 0 512 512">
                  <path d="M0 32l480 0c-2.3 7.2-18.1 56.8-47.3 148.6 48 34.9 79.3 91.5 79.3 155.4l0 8c0 80-72 136-72 136l-304 0S64 424 64 344l0-8c0-63.2 30.6-119.3 77.8-154.3L96 64 32 64 32 224 0 224 0 32zM173.9 176l226.7 0 35.6-112-305.9 0 43.6 112zM96.8 320c-.5 5.3-.8 10.6-.8 16l0 8c0 30.4 13.8 57.7 29.6 78.8 7.8 10.3 15.5 18.6 21.3 24.2l1.1 1 279.9 0 1.1-1c5.8-5.6 13.6-13.8 21.3-24.2 15.8-21.1 29.6-48.4 29.6-78.8l0-8c0-5.4-.3-10.7-.8-16L96.8 320zm6.5-32l369.4 0c-10.1-32.3-30.2-60.1-56.7-80l-256 0c-26.4 19.9-46.5 47.7-56.7 80z"/>
                </svg>
              )}
              {amenity.id === "location" && (
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-auto text-gold" fill="currentColor" viewBox="0 0 384 512">
                  <path d="M384 188.6C384 307.5 264.6 450 214.1 504.9 200.6 519.6 192 528 192 528s-8.6-8.4-22.1-23.1C119.4 450 0 307.5 0 188.6 0 84.4 86 0 192 0S384 84.4 384 188.6zm-352 0c0 31.3 10.1 66.6 27 103.2 16.8 36.4 39.6 72.3 62.8 104.2 26.1 35.8 52.2 66 70.1 85.6 17.9-19.5 44.1-49.8 70.1-85.6 23.2-32 46-67.8 62.8-104.2 17-36.7 27-71.9 27-103.2 0-85.9-71.1-156.6-160-156.6S32 102.6 32 188.6zM144 192a48 48 0 1 0 96 0 48 48 0 1 0 -96 0zm48 80a80 80 0 1 1 0-160 80 80 0 1 1 0 160z"/>
                </svg>
              )}
              {amenity.id === "bath" && (
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gold" fill="currentColor" viewBox="0 0 512 512">
                  <path d="M64 61.3c0-16.2 13.1-29.3 29.3-29.3 7.8 0 15.2 3.1 20.7 8.6L139 65.7c-7 11.1-11 24.2-11 38.3 0 20.2 8.3 38.5 21.8 51.6l-1.1 1.1c-6.2 6.2-6.2 16.4 0 22.6s16.4 6.2 22.6 0l104-104c6.2-6.2 6.2-16.4 0-22.6s-16.4-6.2-22.6 0l-1.1 1.1c-13.1-13.4-31.4-21.8-51.6-21.8-14.1 0-27.2 4-38.3 11L136.6 17.9C125.1 6.5 109.5 0 93.3 0 59.4 0 32 27.4 32 61.3l0 194.7-16 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l16 0 0 80c0 30.5 12.2 58.2 32 78.4L64 496c0 8.8 7.2 16 16 16s16-7.2 16-16l0-26.8c14.5 6.9 30.8 10.8 48 10.8l224 0c17.2 0 33.5-3.9 48-10.8l0 26.8c0 8.8 7.2 16 16 16s16-7.2 16-16l0-49.6c19.8-20.2 32-47.9 32-78.4l0-80 16 0c8.8 0 16-7.2 16-16s-7.2-16-16-16L64 256 64 61.3zM229 76.4L172.4 133c-7.6-7.3-12.4-17.6-12.4-29 0-22.1 17.9-40 40-40 11.4 0 21.7 4.8 29 12.4zM64 288l384 0 0 80c0 44.2-35.8 80-80 80l-224 0c-44.2 0-80-35.8-80-80l0-80z"/>
                </svg>
              )}
            </div>
            <h3 class="font-serif text-lg font-semibold mb-1">{amenity.title}</h3>
            <p class="text-base text-muted-foreground">{amenity.description}</p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Rooms Section -->
  <section class="py-16 lg:py-24">
    <div class="container mx-auto px-4 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="font-serif text-3xl font-semibold tracking-tight sm:text-4xl mb-4">
          Our Rooms
        </h2>
        <p class="text-muted-foreground max-w-2xl mx-auto">
          Six uniquely themed rooms, each with its own character and charm
        </p>
      </div>

      <div class="space-y-24 md:space-y-32 lg:space-y-40">
        {rooms.map((room, index) => (
          <div class:list={[
            "grid gap-8 lg:gap-12 items-center max-w-5xl mx-auto",
            "md:grid-cols-5"
          ]}>
            <!-- Clickable Hero Image with Gallery -->
            <div class:list={[
              "overflow-hidden shadow-lg md:col-span-2",
              index % 2 === 1 ? "md:order-last" : ""
            ]}>
              <RoomImageWithGallery
                client:visible
                heroSrc={room.thumbnails[0].src}
                heroAlt={room.name}
                images={room.images}
                thumbnails={room.thumbnails}
                roomName={room.name}
              />
            </div>

            <!-- Room Info -->
            <div class="md:col-span-3">
              <div class="flex items-baseline gap-3 mb-3">
                <h3 class="font-serif text-2xl font-semibold sm:text-3xl">
                  {room.name}
                </h3>
                <span class="text-xl font-semibold text-gold">{room.price}</span>
              </div>

              <p class="text-lg text-muted-foreground mb-4">
                {room.description}
              </p>

              <!-- Features -->
              <p class="text-sm text-muted-foreground mb-6">
                {room.features.join(' · ')}
              </p>

              <!-- Reserve Button -->
              <Button
                href="tel:6056244500"
                variant="gold"
                size="lg"
                class="inline-flex items-center gap-2"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
                Call to Reserve
              </Button>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Special Rates Notice -->
  <section class="bg-muted-light py-12 lg:py-16">
    <div class="container mx-auto px-4 lg:px-8">
      <div class="mx-auto max-w-3xl text-center">
        <h2 class="font-serif text-2xl font-semibold sm:text-3xl mb-4 text-gold">
          Special Event Rates
        </h2>
        <p class="text-muted-foreground mb-4">
          During Dakota Days, USD Graduation, and other special weekends, our rates are adjusted:
        </p>
        <div class="flex flex-wrap justify-center gap-4 text-sm">
          <span class="bg-background px-4 py-2 rounded-full border border-border">Honeymoon Suite: $195</span>
          <span class="bg-background px-4 py-2 rounded-full border border-border">Premium Rooms: $175</span>
          <span class="bg-background px-4 py-2 rounded-full border border-border">Native American: $160</span>
        </div>
        <p class="mt-4 text-muted-foreground text-sm">
          2-night minimum stay required for special event weekends
        </p>
      </div>
    </div>
  </section>

  <!-- Policies Section -->
  <section class="py-16 lg:py-24">
    <div class="container mx-auto px-4 lg:px-8">
      <div class="mx-auto max-w-4xl">
        <h2 class="font-serif text-3xl font-semibold tracking-tight text-center sm:text-4xl mb-12">
          Guest Information
        </h2>

        <div class="space-y-8">
          <!-- Policies -->
          <div class="border border-border bg-background p-6">
            <h3 class="font-serif text-xl font-semibold mb-4 text-gold">Policies</h3>
            <ul class="space-y-3 text-muted-foreground text-base">
              <li>Children, with adult supervision, are always welcome at Valiant Vineyards Winery & Distillery, provided that all guests are able to enjoy a relaxing, restful, and undisturbed stay.</li>
              <li>A two-night minimum stay is required on USD Graduation Weekends and D-Days Weekends.</li>
              <li>Room rates are based on double occupancy. For each additional person, there is a reasonable per-night surcharge, which covers breakfast and other costs. Children 10 years of age and under stay free; guests 11 years and older are $15 per night.</li>
              <li>No pets allowed.</li>
              <li>Room reservations are guaranteed with a credit card.</li>
              <li>We have a 7-day cancellation policy—30 days for graduation, Dakota Days, and group reservations.</li>
            </ul>
          </div>

          <div class="grid gap-8 md:grid-cols-2">
            <!-- Check-in/out -->
            <div class="border border-border bg-background p-6">
              <h3 class="font-serif text-xl font-semibold mb-4 text-gold">Check-In & Check-Out</h3>
              <ul class="space-y-2 text-muted-foreground">
                <li>Check-in is after 2:00 p.m.</li>
                <li>Check-out is at 11:00 a.m.</li>
              </ul>
            </div>

            <!-- Other -->
            <div class="border border-border bg-background p-6">
              <h3 class="font-serif text-xl font-semibold mb-4 text-gold">Other</h3>
              <ul class="space-y-2 text-muted-foreground">
                <li>Breakfast is served between 8:00 a.m. and 10:00 a.m.</li>
                <li>Winery gift certificates are available.</li>
                <li>Special guest packages are offered year-round.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="bg-neutral-50 py-16 lg:py-20">
    <div class="container mx-auto px-4 lg:px-8 text-center">
      <h2 class="font-serif text-3xl font-semibold tracking-tight sm:text-4xl mb-4">
        Ready to Book Your Stay?
      </h2>
      <p class="text-foreground mb-8 max-w-xl mx-auto">
        Call us to reserve your room and start planning your getaway.
      </p>
      <Button
        href="tel:6056244500"
        variant="gold"
        size="lg"
        class="inline-flex items-center gap-2"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
        </svg>
        (605) 624-4500
      </Button>
    </div>
  </section>
</BaseLayout>
